# API de Enfermera Jefe - Sistema de Gesti√≥n Hospitalaria

## Descripci√≥n General

La API de Enfermera Jefe permite gestionar completamente las cirug√≠as en el sistema hospitalario. Incluye funcionalidades para crear, editar, eliminar, iniciar y finalizar cirug√≠as, as√≠ como asignar personal m√©dico y quir√≥fanos.

**Base URL**: `/api/v1/enfermera_jefe`

---

## üè• Gesti√≥n de Cirug√≠as

### 1. Crear Nueva Cirug√≠a

Crear una nueva cirug√≠a y asignarla a un quir√≥fano espec√≠fico.

```http
POST /api/v1/enfermera_jefe/cirugias
```

**Headers:**
```json
{
  "Content-Type": "application/json",
  "Authorization": "Bearer {token}"
}
```

**Body:**
```json
{
  "paciente_id": 1,
  "tipo_cirugia_id": 3,
  "quirofano_id": 2,
  "cirujano_principal_id": 5,
  "instrumentador_id": 12,
  "fecha_programada": "2025-01-20T14:30:00.000Z",
  "prioridad": "alta",
  "observaciones_previas": "Paciente con antecedentes de diabetes",
  "diagnostico_preoperatorio": "Apendicitis aguda",
  "personal_auxiliar": [
    {
      "usuario_id": 15,
      "rol_cirugia": "anestesiologo"
    },
    {
      "usuario_id": 18,
      "rol_cirugia": "cirujano_auxiliar"
    },
    {
      "usuario_id": 22,
      "rol_cirugia": "residente"
    }
  ]
}
```

**Respuesta Exitosa (201):**
```json
{
  "success": true,
  "message": "Cirug√≠a creada y asignada exitosamente",
  "data": {
    "id": 45,
    "paciente_id": 1,
    "tipo_cirugia_id": 3,
    "quirofano_id": 2,
    "cirujano_principal_id": 5,
    "instrumentador_id": 12,
    "fecha_programada": "2025-01-20T14:30:00.000Z",
    "estado": "programada",
    "prioridad": "alta",
    "observaciones_previas": "Paciente con antecedentes de diabetes",
    "diagnostico_preoperatorio": "Apendicitis aguda",
    "paciente": {
      "id": 1,
      "nombre": "Juan",
      "apellido": "P√©rez",
      "cedula": "12345678"
    },
    "tipo_cirugia": {
      "id": 3,
      "nombre": "Apendicectom√≠a",
      "categoria": "general"
    },
    "quirofano": {
      "id": 2,
      "nombre": "Quir√≥fano B",
      "estado": "libre"
    },
    "cirujano_principal": {
      "id": 5,
      "nombre": "Dr. Garc√≠a",
      "especialidad": "Cirug√≠a General"
    },
    "personal": [
      {
        "usuario_id": 15,
        "rol_cirugia": "anestesiologo",
        "usuario": {
          "nombre": "Dr. L√≥pez",
          "apellido": "Anestesi√≥logo"
        }
      }
    ]
  }
}
```

---

### 2. Obtener Todas las Cirug√≠as

Obtener lista de cirug√≠as con filtros opcionales.

```http
GET /api/v1/enfermera_jefe/cirugias
```

**Query Parameters:**
- `fecha_inicio` (opcional): Fecha de inicio del rango (ISO format)
- `fecha_fin` (opcional): Fecha de fin del rango (ISO format)
- `estado` (opcional): Estado de la cirug√≠a (`programada`, `en_curso`, `finalizada`, etc.)
- `quirofano_id` (opcional): ID del quir√≥fano
- `cirujano_id` (opcional): ID del cirujano principal
- `prioridad` (opcional): Prioridad de la cirug√≠a (`baja`, `media`, `alta`, `urgente`)

**Ejemplos de uso:**
```http
GET /api/v1/enfermera_jefe/cirugias?fecha_inicio=2025-01-20&estado=programada
GET /api/v1/enfermera_jefe/cirugias?quirofano_id=2&prioridad=alta
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠as obtenidas exitosamente",
  "data": [
    {
      "id": 45,
      "fecha_programada": "2025-01-20T14:30:00.000Z",
      "estado": "programada",
      "prioridad": "alta",
      "paciente": {
        "nombre": "Juan P√©rez"
      },
      "quirofano": {
        "nombre": "Quir√≥fano B"
      },
      "cirujano_principal": {
        "nombre": "Dr. Garc√≠a"
      }
    }
  ]
}
```

---

### 3. Obtener Cirug√≠a por ID

Obtener detalles completos de una cirug√≠a espec√≠fica.

```http
GET /api/v1/enfermera_jefe/cirugias/{id}
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a obtenida exitosamente",
  "data": {
    "id": 45,
    "paciente_id": 1,
    "fecha_programada": "2025-01-20T14:30:00.000Z",
    "fecha_inicio": null,
    "fecha_fin": null,
    "estado": "programada",
    "prioridad": "alta",
    "observaciones_previas": "Paciente con antecedentes de diabetes",
    "observaciones_finales": null,
    "diagnostico_preoperatorio": "Apendicitis aguda",
    "diagnostico_postoperatorio": null,
    "duracion_real_minutos": null,
    "paciente": { /* detalles del paciente */ },
    "quirofano": { /* detalles del quir√≥fano */ },
    "cirujano_principal": { /* detalles del cirujano */ },
    "instrumentador": { /* detalles del instrumentador */ },
    "personal": [ /* personal auxiliar */ ]
  }
}
```

---

### 4. Editar Cirug√≠a

Actualizar una cirug√≠a existente (solo permitido para cirug√≠as no iniciadas).

```http
PUT /api/v1/enfermera_jefe/cirugias/{id}
```

**Body:**
```json
{
  "fecha_programada": "2025-01-21T15:00:00.000Z",
  "quirofano_id": 3,
  "prioridad": "urgente",
  "observaciones_previas": "Actualizaci√≥n: Paciente requiere atenci√≥n urgente",
  "personal_auxiliar": [
    {
      "usuario_id": 20,
      "rol_cirugia": "anestesiologo"
    }
  ]
}
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a actualizada exitosamente",
  "data": { /* cirug√≠a actualizada */ }
}
```

---

### 5. Posponer Cirug√≠a

Posponer una cirug√≠a programada con motivo.

```http
PUT /api/v1/enfermera_jefe/cirugias/{id}/posponer
```

**Body:**
```json
{
  "nueva_fecha": "2025-01-22T14:30:00.000Z",
  "motivo": "Emergencia m√©dica en quir√≥fano asignado"
}
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a pospuesta exitosamente",
  "data": {
    "id": 45,
    "estado": "pospuesta",
    "fecha_programada": "2025-01-22T14:30:00.000Z",
    "observaciones_previas": "Paciente con antecedentes de diabetes\n\nCIRUG√çA POSPUESTA: Emergencia m√©dica en quir√≥fano asignado"
  }
}
```

---

### 6. Cancelar Cirug√≠a

Cancelar una cirug√≠a (marca como cancelada sin eliminar).

```http
DELETE /api/v1/enfermera_jefe/cirugias/{id}
```

**Body:**
```json
{
  "motivo": "Paciente no se present√≥ para la cirug√≠a"
}
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a cancelada exitosamente"
}
```

---

## üöÄ Control de Estado de Cirug√≠as

### 7. Iniciar Cirug√≠a

Cambiar el estado de una cirug√≠a a "en curso" y registrar hora de inicio.

```http
PUT /api/v1/enfermera_jefe/cirugias/{id}/iniciar
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a iniciada exitosamente",
  "data": {
    "id": 45,
    "estado": "en_curso",
    "fecha_inicio": "2025-01-20T14:35:00.000Z"
  }
}
```

---

### 8. Finalizar Cirug√≠a

Finalizar una cirug√≠a en curso y a√±adir observaciones del personal m√©dico.

```http
PUT /api/v1/enfermera_jefe/cirugias/{id}/finalizar
```

**Body:**
```json
{
  "observaciones_finales": "Cirug√≠a completada sin complicaciones",
  "diagnostico_postoperatorio": "Apendicectom√≠a exitosa, paciente estable",
  "observaciones_cirujano": "Procedimiento est√°ndar, sin hallazgos inusuales",
  "observaciones_anestesiologo": "Anestesia general sin complicaciones, despertar normal"
}
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Cirug√≠a finalizada exitosamente",
  "data": {
    "id": 45,
    "estado": "finalizada",
    "fecha_fin": "2025-01-20T16:15:00.000Z",
    "duracion_real_minutos": 100,
    "observaciones_finales": "OBSERVACIONES GENERALES:\nCirug√≠a completada sin complicaciones\n\nOBSERVACIONES DEL CIRUJANO:\nProcedimiento est√°ndar, sin hallazgos inusuales\n\nOBSERVACIONES DEL ANESTESI√ìLOGO:\nAnestesia general sin complicaciones, despertar normal",
    "diagnostico_postoperatorio": "Apendicectom√≠a exitosa, paciente estable"
  }
}
```

---

## üë• Gesti√≥n de Recursos

### 9. Obtener Personal Disponible

Consultar personal m√©dico disponible para asignar a cirug√≠as.

```http
GET /api/v1/enfermera_jefe/personal-disponible
```

**Query Parameters:**
- `tipo_personal` (opcional): Tipo de personal (`cirujanos`, `instrumentadores`, `anestesiologos`, `auxiliares`)
- `fecha` (opcional): Fecha para verificar disponibilidad

**Ejemplos:**
```http
GET /api/v1/enfermera_jefe/personal-disponible?tipo_personal=cirujanos
GET /api/v1/enfermera_jefe/personal-disponible?tipo_personal=anestesiologos&fecha=2025-01-20
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Personal disponible obtenido exitosamente",
  "data": [
    {
      "id": 15,
      "nombre": "Dr. L√≥pez",
      "apellido": "Anestesi√≥logo",
      "cedula": "87654321",
      "rol": {
        "nombre": "anestesiologo"
      }
    }
  ]
}
```

---

### 10. Obtener Quir√≥fanos Disponibles

Consultar quir√≥fanos disponibles para una fecha y hora espec√≠fica.

```http
GET /api/v1/enfermera_jefe/quirofanos-disponibles
```

**Query Parameters (Requeridos):**
- `fecha`: Fecha en formato YYYY-MM-DD
- `hora`: Hora en formato HH:MM

**Ejemplo:**
```http
GET /api/v1/enfermera_jefe/quirofanos-disponibles?fecha=2025-01-20&hora=14:30
```

**Respuesta Exitosa (200):**
```json
{
  "success": true,
  "message": "Quir√≥fanos disponibles obtenidos exitosamente",
  "data": [
    {
      "id": 1,
      "nombre": "Quir√≥fano A",
      "ubicacion": "Planta 2",
      "estado": "libre",
      "categoria_quirofano": {
        "nombre": "General"
      }
    },
    {
      "id": 3,
      "nombre": "Quir√≥fano C",
      "ubicacion": "Planta 2",
      "estado": "libre",
      "categoria_quirofano": {
        "nombre": "Cardiovascular"
      }
    }
  ]
}
```

---

## üìã Estados de Cirug√≠a

Las cirug√≠as pueden tener los siguientes estados:

- **`programada`**: Cirug√≠a planificada pero no iniciada
- **`en_preparacion`**: Quir√≥fano siendo preparado
- **`conteo_inicial`**: Realizando conteo inicial de instrumentos
- **`en_curso`**: Cirug√≠a en progreso
- **`conteo_final`**: Realizando conteo final de instrumentos
- **`finalizada`**: Cirug√≠a completada
- **`cancelada`**: Cirug√≠a cancelada
- **`pospuesta`**: Cirug√≠a pospuesta para otra fecha

## üéØ Roles de Personal en Cirug√≠a

- **`cirujano_auxiliar`**: Cirujano de apoyo
- **`anestesiologo`**: Responsable de la anestesia
- **`residente`**: M√©dico en formaci√≥n
- **`observador`**: Personal en observaci√≥n/aprendizaje

## üö® Prioridades de Cirug√≠a

- **`baja`**: Cirug√≠a electiva, no urgente
- **`media`**: Cirug√≠a programada est√°ndar
- **`alta`**: Cirug√≠a importante, prioridad elevada
- **`urgente`**: Cirug√≠a de emergencia

---

## ‚ö†Ô∏è C√≥digos de Error Comunes

### 400 - Bad Request
```json
{
  "success": false,
  "message": "No se puede editar una cirug√≠a en curso o finalizada"
}
```

### 404 - Not Found
```json
{
  "success": false,
  "message": "Cirug√≠a no encontrada"
}
```

### 409 - Conflict
```json
{
  "success": false,
  "message": "El quir√≥fano no est√° disponible en el horario solicitado"
}
```

### 500 - Internal Server Error
```json
{
  "success": false,
  "message": "Error interno del servidor"
}
```

---

## üí° Notas Importantes

1. **Verificaci√≥n de Disponibilidad**: El sistema verifica autom√°ticamente la disponibilidad de quir√≥fanos con un margen de ¬±2 horas.

2. **Estados Inmutables**: No se pueden editar cirug√≠as en estado `en_curso` o `finalizada`.

3. **Personal Auxiliar**: El array de personal auxiliar se reemplaza completamente en cada actualizaci√≥n.

4. **Observaciones M√∫ltiples**: Al finalizar una cirug√≠a, se pueden agregar observaciones separadas por tipo de personal m√©dico.

5. **Duraci√≥n Autom√°tica**: La duraci√≥n de la cirug√≠a se calcula autom√°ticamente basada en las fechas de inicio y fin.

6. **Soft Delete**: Las cirug√≠as canceladas no se eliminan f√≠sicamente, solo se marcan como canceladas.

---

Esta documentaci√≥n cubre todas las funcionalidades principales de la API de Enfermera Jefe. Para m√°s detalles sobre autenticaci√≥n y autorizaci√≥n, consultar la documentaci√≥n general de la API. 